name: build

on:
  workflow_dispatch:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: windows-2019
    permissions: write-all
    steps:
      - uses: actions/checkout@v3

#       - name: Setup NuGet
#         uses: NuGet/setup-nuget@v1.0.5

#       - name: Setup MSBuild
#         uses: microsoft/setup-msbuild@v1.1

#       - name: EETLauncher_snk
#         env:
#           EETLauncher_snk: ${{ secrets.EETLauncher_snk }}
#         run: |
#           Set-Content -Path "EETLauncher/EETLauncher.snk" -Value ([System.Convert]::FromBase64String($env:EETLauncher_snk)) -AsByteStream
      
#       - name: EETLauncherWPF_TemporaryKey_pfx
#         env:
#           EETLauncherWPF_TemporaryKey_pfx: ${{ secrets.EETLauncherWPF_TemporaryKey_pfx }}
#         run: |
#           Set-Content -Path "EETLauncher/EETLauncherWPF_TemporaryKey.pfx" -Value ([System.Convert]::FromBase64String($env:EETLauncherWPF_TemporaryKey_pfx)) -AsByteStream

#       - name: Get-Childitem -Recurse
#         run: |
#           Get-Childitem -Recurse
      
#       - name: Import-PfxCertificate
#         run: |
#           Import-PfxCertificate -FilePath "D:\a\EETLauncher-WPF\EETLauncher-WPF\EETLauncher\EETLauncherWPF_TemporaryKey.pfx" -CertStoreLocation Cert:\CurrentUser\My
      
#       - name: Restore Packages
#         run: nuget restore EETLauncher/EETLauncherWPF.csproj

#       - name: Build solution
#         run: msbuild EETLauncher/EETLauncherWPF.csproj -property:Configuration=Release
      
      - uses: actions/checkout@v3
      
      - name: Set-Location
        run: |
          Set-Location ../..
          New-Item -ItemType Directory -Name Temp | Set-Location
          #Copy-Item -Path D:\a\EETLauncher-WPF\EETLauncher-WPF\EETLauncher\bin\Release\EETLauncher.exe
          echo $env:GITHUB_RUN_ID | Out-File z.txt

      - name: Pushes test file
        uses: dmnemec/copy_file_to_another_repo_action@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
        with:
          source_file: 'z.txt'
          destination_repo: 'ALIENQuake/EETLauncher'
          user_email: 'alienquake@hotmail.com'
          user_name: 'ALIENQuake'
          commit_message: 'Add files via upload'

#       - name: Pushes to another repository
#         uses: cpina/github-action-push-to-another-repository@main
#         env:
#           SSH_DEPLOY_KEY: ${{ secrets.SSH_DEPLOY_KEY }}
#         with:
#           source-directory: 'Temp'
#           destination-github-username: 'ALIENQuake'
#           destination-repository-name: 'EETLauncher'
#           user-email: alienquake@hotmail.com
#           commit-message: Add files via upload

      - name: Finish
        run: echo Finish
        
