name: build

on:
  workflow_dispatch:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: windows-2019
    permissions: write-all
    steps:
      
      - name: Checkout Source
        uses: actions/checkout@v3
        with:
          path: ./Source

#       - name: Setup NuGet
#         uses: NuGet/setup-nuget@v1.0.5

#       - name: Setup MSBuild
#         uses: microsoft/setup-msbuild@v1.1

#       - name: EETLauncher_snk
#         env:
#           EETLauncher_snk: ${{ secrets.EETLauncher_snk }}
#         run: |
#           Set-Content -Path "EETLauncher/EETLauncher.snk" -Value ([System.Convert]::FromBase64String($env:EETLauncher_snk)) -AsByteStream
      
#       - name: EETLauncherWPF_TemporaryKey_pfx
#         env:
#           EETLauncherWPF_TemporaryKey_pfx: ${{ secrets.EETLauncherWPF_TemporaryKey_pfx }}
#         run: |
#           Set-Content -Path "EETLauncher/EETLauncherWPF_TemporaryKey.pfx" -Value ([System.Convert]::FromBase64String($env:EETLauncherWPF_TemporaryKey_pfx)) -AsByteStream

#       - name: Get-Childitem -Recurse
#         run: |
#           Get-Childitem -Recurse
      
#       - name: Import-PfxCertificate
#         run: |
#           Import-PfxCertificate -FilePath "D:\a\EETLauncher-WPF\EETLauncher-WPF\EETLauncher\EETLauncherWPF_TemporaryKey.pfx" -CertStoreLocation Cert:\CurrentUser\My
      
#       - name: Restore Packages
#         run: nuget restore EETLauncher/EETLauncherWPF.csproj

#       - name: Build solution
#         run: msbuild EETLauncher/EETLauncherWPF.csproj -property:Configuration=Release
      
      - name: Checkout Destination
        uses: actions/checkout@master
        with: 
          repository: tomassirio/projectB
          token: ${{ secrets.ACTIONS_TOKEN }}
          path: ./Destination
      
      - name: Create file
        run: |
          #Copy-Item -Path D:\a\EETLauncher-WPF\EETLauncher-WPF\EETLauncher\bin\Release\EETLauncher.exe
          echo $env:GITHUB_RUN_ID | Out-File z.txt
      
      - name: Push Destination
        run: |
          cd ./projectB
          git add .
          git config user.email "alienquake@hotmail.com"
          git config user.name "ALIENQuake"
          git commit -am "Add files via upload"
          git push
 
      - name: Finish
        run: echo Finish
        
